(this.webpackJsonpbbit8=this.webpackJsonpbbit8||[]).push([[0],{24:function(t,e,n){t.exports=n(36)},30:function(t,e,n){},36:function(t,e,n){"use strict";n.r(e);var o=n(13),a=n.n(o),i=n(1),r=n(2),s=n(9),c=n(8),u=n(10),l=n(0),h=n.n(l),b=n(21),f=n.n(b),d=n(4),k=n.n(d),v=new(function(){function t(){Object(i.a)(this,t),this.channels={}}return Object(r.a)(t,[{key:"addChannel",value:function(t,e){this.channels[t]=e}},{key:"getChannel",value:function(t){return this.channels[t]}},{key:"removeChannel",value:function(t){delete this.channels[t]}}]),t}()),m=1,y=2,p=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;Object(i.a)(this,t),this.message=[],this.takers=[],this.mode=e}return Object(r.a)(t,[{key:"put",value:function(t){if(this.takers.length>0)if(this.mode===m){var e=this.takers.slice();this.takers=[];var n=!0,o=!1,a=void 0;try{for(var i,r=e[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var s=i.value;try{s(t)}catch(c){console.log("[Channel] put error: ",t,c)}}}catch(u){o=!0,a=u}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}}else this.takers.shift()(t);else this.message.push(t)}},{key:"take",value:function(){var t=this;return new Promise((function(e){t.message.length>0?e(t.message.shift()):t.takers.push(e)}))}},{key:"hasTaker",value:function(){return this.takers.length>0}}]),t}(),R=new(function(){function t(){Object(i.a)(this,t),this.entities={}}return Object(r.a)(t,[{key:"addEntity",value:function(t,e){this.entities[t]=e}},{key:"getEntity",value:function(t){return this.entities[t]}},{key:"removeEntity",value:function(t){delete this.entities[t]}}]),t}()),g=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(s.a)(this,Object(c.a)(e).call(this,t))).mounted=!1,t.entity&&(n.entity=t.entity,n.id=n.entity.id,R.addEntity(n.id,n.entity),n.state=n.entity.getState(),n.channel=new p,v.addChannel(n.id,n.channel)),n}return Object(u.a)(e,t),Object(r.a)(e,[{key:"componentDidMount",value:function(){this.mounted=!0,this.loop()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"loop",value:function(){var t;return a.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mounted){e.next=7;break}return e.next=3,a.a.awrap(this.channel.take());case 3:t=e.sent,this.remote(t),e.next=0;break;case 7:case"end":return e.stop()}}),null,this)}},{key:"remote",value:function(t){}}]),e}(l.Component),C=function(){function t(e){Object(i.a)(this,t),this.id=e,this.state={canCross:!0,isRobot:!1}}return Object(r.a)(t,[{key:"getState",value:function(){return this.state}},{key:"setCross",value:function(t){this.state.canCross=t}},{key:"canCross",value:function(){return this.state.canCross}},{key:"setRobot",value:function(){this.state.isRobot=!0}}]),t}(),O=0,j=1,S=2,I=3,L=4,E=0,x=1,w=2,M=3,B=4,G=function(){function t(e){Object(i.a)(this,t),this.id=e,this.state={refresh:!1},this.difficulty=.2,this.blocks=[],this.blockIdMap={},this.blockLocGrid=[[],[],[],[]],this.blockIdLocMap={},this.canCrossBlocks=[],this.robotId=0,this.robotState=O,this.initBlocks(),this.initRobot(),this.score=0}return Object(r.a)(t,[{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRobotId",value:function(){return this.robotId}},{key:"getRandomRobotId",value:function(){return this.canCrossBlocks[Math.floor(Math.random()*this.canCrossBlocks.length)].id}},{key:"setRobotId",value:function(t){this.robotId=t,this.robotState=O}},{key:"initBlocks",value:function(){for(var t=[],e=[],n=0;n<16;++n){var o="block:".concat(n+1),a=new C(o),i=Math.random()>=this.difficulty;i&&e.push(a),a.setCross(i),t.push(a);var r=n%4,s=Math.floor(n/4);this.blockLocGrid[r][s]=o,this.blockIdLocMap[o]=[r,s],this.blockIdMap[o]=a,this.canCrossBlocks=e}this.blocks=t}},{key:"initRobot",value:function(){var t=this.canCrossBlocks[Math.floor(Math.random()*this.canCrossBlocks.length)];this.robotId=t.id,t.setRobot()}},{key:"updateRobotLoc",value:function(t,e){var n=t.slice();switch(e){case j:return n[0]--,n;case S:return n[0]++,n;case I:return n[1]--,n;case L:return n[1]++,n}}},{key:"getRobotSurr",value:function(t){var e="",n=this.updateRobotLoc(t,j),o=this.blockLocGrid[n[0]],a=o?o[n[1]]:0;return a&&this.blockIdMap[a].canCross()?e+="x":e+="U",n=this.updateRobotLoc(t,S),(a=(o=this.blockLocGrid[n[0]])?o[n[1]]:0)&&this.blockIdMap[a].canCross()?e+="x":e+="D",n=this.updateRobotLoc(t,I),(a=(o=this.blockLocGrid[n[0]])?o[n[1]]:0)&&this.blockIdMap[a].canCross()?e+="x":e+="L",n=this.updateRobotLoc(t,L),(a=(o=this.blockLocGrid[n[0]])?o[n[1]]:0)&&this.blockIdMap[a].canCross()?e+="x":e+="R",e}},{key:"getRobotActionByRules",value:function(t){var e=[],n=!0,o=!1,a=void 0;try{for(var i,r=t[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var s=i.value;s.state===this.robotState&&e.push(s)}}catch(w){o=!0,a=w}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}console.log("[getRobotActionByRules] effectiveRules:%j",e);for(var c=this.blockIdLocMap[this.robotId],u=this.getRobotSurr(c),l=0,h=e;l<h.length;l++){var b=h[l];if(b.match(u))switch(this.robotState=b.newState,b.action){case"U":var f=this.updateRobotLoc(c,j),d=this.blockLocGrid[f[0]],k=d?d[f[1]]:0;if(k)if(this.blockIdMap[k].canCross())return{action:x,loc:f,id:k};case"D":var v=this.updateRobotLoc(c,S),m=this.blockLocGrid[v[0]],y=m?m[v[1]]:0;if(y)if(this.blockIdMap[y].canCross())return{action:x,loc:v,id:y};case"L":var p=this.updateRobotLoc(c,I),R=this.blockLocGrid[p[0]],g=R?R[p[1]]:0;if(g)if(this.blockIdMap[g].canCross())return{action:x,loc:p,id:g};case"R":var C=this.updateRobotLoc(c,L),O=this.blockLocGrid[C[0]],E=O?O[C[1]]:0;if(E)if(this.blockIdMap[E].canCross())return{action:x,loc:C,id:E}}}}},{key:"getRobotAction",value:function(){switch(this.robotState){case O:case j:case S:case I:case L:var t=this.blockIdLocMap[this.robotId],e=this.updateRobotLoc(t,j),n=this.blockLocGrid[e[0]],o=n?n[e[1]]:0;if(o)if(this.blockIdMap[o].canCross())return{action:x,loc:e,id:o};if(e=this.updateRobotLoc(t,S),o=(n=this.blockLocGrid[e[0]])?n[e[1]]:0)if(this.blockIdMap[o].canCross())return{action:w,loc:e,id:o};if(e=this.updateRobotLoc(t,I),o=(n=this.blockLocGrid[e[0]])?n[e[1]]:0)if(this.blockIdMap[o].canCross())return{action:M,loc:e,id:o};if(e=this.updateRobotLoc(t,L),o=(n=this.blockLocGrid[e[0]])?n[e[1]]:0)if(this.blockIdMap[o].canCross())return{action:B,loc:e,id:o}}return{action:E,loc:this.blockIdLocMap[this.robotId],id:this.robotId}}}]),t}(),N=function(){function t(e){Object(i.a)(this,t),this.id=e,this.state={value:"# \u89c4\u5219\u683c\u5f0f: \n#\t\u72b6\u6001 \u5468\u56f4\u73af\u5883 -> \u52a8\u4f5c \u65b0\u72b6\u6001\n# \u72b6\u6001\u96c6\u5408: \n#\t0-\u9759\u6b62 1-\u5411\u4e0a 2-\u5411\u4e0b 3-\u5411\u5de6 4-\u5411\u53f3\n# \u5468\u56f4\u73af\u5883\u8868\u793a:\n#\t*-\u4efb\u610f x-\u53ef\u901a\u884c U/D/L/R-\u4e0d\u53ef\u901a\u884c\n#\t\u6bd4\u5982,\n#\t1)UDLR \u8868\u793a\u4e0a\u4e0b\u5de6\u53f3\u90fd\u4e0d\u53ef\u901a\u884c\n#\t2)x*** \u8868\u793a\u673a\u5668\u4eba\u4e0a\u65b9\u53ef\u901a\u884c\n#\t3)U*** \u8868\u793a\u673a\u5668\u4eba\u4e0a\u65b9\u4e0d\u53ef\u901a\u884c\n# \u52a8\u4f5c\u96c6\u5408: \n#\t0-\u505c\u6b62 1-\u5411\u4e0a 2-\u5411\u4e0b 3-\u5411\u5de6 4-\u5411\u53f3\n# \n# \u673a\u5668\u4eba\u521d\u59cb\u72b6\u6001\u4e3a0\n# \n0 x*** -> U 1\n0 U*** -> D 1\n1 x*** -> U 1\n1 U*** -> D 2\n2 *x** -> D 2\n",check:""}}return Object(r.a)(t,[{key:"getState",value:function(){return this.state}}]),t}(),P=function(){function t(e){Object(i.a)(this,t);var n=e.split(" ");this.state=n[0]-0,this.surr=n[1],this.action=n[3],this.newState=n[4]-0}return Object(r.a)(t,[{key:"match",value:function(t){for(var e=0;e<this.surr.length;++e){var n=t[e],o=this.surr[e];if("*"!==o&&o!==n)return!1}return!0}}]),t}(),U=(n(30),n(16)),D=n(11);function J(t){return new Promise((function(e){return setTimeout(e,t)}))}var A=function(t){function e(t){return Object(i.a)(this,e),Object(s.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(r.a)(e,[{key:"getStyle",value:function(){return this.state.canCross?"block":"barrier"}},{key:"remote",value:function(t){switch(console.log("[BlockSystem] id:".concat(this.id,", msg:").concat(JSON.stringify(t))),t.cmd){case k.a.CanCross:this.setState((function(e){return{canCross:t.canCross}}));break;case k.a.SetRobot:this.setState((function(t){return{isRobot:!0}}));break;case k.a.ClearRobot:this.setState((function(t){return{isRobot:!1}}))}}},{key:"getRobotView",value:function(){if(this.state.isRobot)return h.a.createElement("div",{className:"robot"})}},{key:"render",value:function(){return h.a.createElement("div",{className:this.getStyle()},this.entity.id,this.getRobotView())}}]),e}(g),T=function(t){function e(t){var n;return Object(i.a)(this,e),(n=Object(s.a)(this,Object(c.a)(e).call(this,t))).blockSystems=[],n.initBlockSystem(),n.robotPath=!1,n}return Object(u.a)(e,t),Object(r.a)(e,[{key:"initBlockSystem",value:function(){for(var t=[],e=this.entity.getBlocks(),n=0;n<e.length;++n)t.push(h.a.createElement(A,{key:n+1,entity:e[n]}));this.blockSystems=t}},{key:"remote",value:function(t){console.log("[GridSystem] id:".concat(this.id,", msg:").concat(JSON.stringify(t))),t.cmd===k.a.Refresh?this.setState((function(t){return{refresh:!t.refresh}})):t.cmd===k.a.PathRobot&&(this.robotPath=!0,this.pathRobot(t.rules))}},{key:"refresh",value:function(){this.robotPath=!1,this.entity.initBlocks();for(var t=this.entity.getBlocks(),e=0;e<t.length;++e){var n=t[e];v.getChannel(n.id).put({cmd:k.a.CanCross,canCross:n.canCross()})}this.setRobot()}},{key:"pathRobot",value:function(t){var e,n,o,i,r,s,c,u;return a.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.robotPath){l.next=30;break}for(e=[],n=!0,o=!1,i=void 0,l.prev=5,r=t[Symbol.iterator]();!(n=(s=r.next()).done);n=!0)c=s.value,e.push(new P(c));l.next=13;break;case 9:l.prev=9,l.t0=l.catch(5),o=!0,i=l.t0;case 13:l.prev=13,l.prev=14,n||null==r.return||r.return();case 16:if(l.prev=16,!o){l.next=19;break}throw i;case 19:return l.finish(16);case 20:return l.finish(13);case 21:if(u=this.entity.getRobotActionByRules(e),console.log("[pathRobot] robotPath:".concat(this.robotPath,", action:%j"),u),u){l.next=25;break}return l.abrupt("break",30);case 25:return this.setRobot(u.id),l.next=28,a.a.awrap(J(850));case 28:l.next=0;break;case 30:case"end":return l.stop()}}),null,this,[[5,9,13,21],[14,,16,20]])}},{key:"setRobot",value:function(t){var e=this.entity.getRobotId();e&&v.getChannel(e).put({cmd:k.a.ClearRobot}),e=t||this.entity.getRandomRobotId(),this.entity.setRobotId(e),console.log("getRobot ",e),v.getChannel(e).put({cmd:k.a.SetRobot})}},{key:"render",value:function(){return this.state.refresh&&(this.refresh(),this.channel.put({cmd:k.a.Refresh})),h.a.createElement("div",{className:"grid"},this.blockSystems)}}]),e}(g),V=function(t){function e(t){return Object(i.a)(this,e),Object(s.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(r.a)(e,[{key:"rulesCheck",value:function(t){var e=[],n=!0,o=!1,a=void 0;try{for(var i,r=t[Symbol.iterator]();!(n=(i=r.next()).done);n=!0){var s=i.value,c=s.split(" ");if(console.log("[rulesCheck]",c),c.length&&c[0].length&&"#"!==c[0][0]){if(5!==c.length)return!1;var u=c[0]-0,l=c[1],h=c[3],b=c[4]-0;if(isNaN(u)||u<0||u>4)return console.log("[rulesCheck]  state error",u),!1;if(isNaN(b)||b<0||b>4)return console.log("[rulesCheck]  newState error",b),!1;if("U"!==h&&"D"!==h&&"L"!==h&&"R"!==h)return console.log("[rulesCheck]  action error",h),!1;if(4!==l.length||"x"!==l[0]&&"*"!==l[0]&&"U"!==l[0]||"x"!==l[1]&&"*"!==l[1]&&"D"!==l[1]||"x"!==l[2]&&"*"!==l[2]&&"L"!==l[2]||"x"!==l[3]&&"*"!==l[3]&&"R"!==l[3])return console.log("[rulesCheck]  surr error",l),!1;e.push(s)}}}catch(f){o=!0,a=f}finally{try{n||null==r.return||r.return()}finally{if(o)throw a}}return e}},{key:"remote",value:function(t){if(console.log("[RulesInputSystem] id:".concat(this.id,", msg:").concat(JSON.stringify(t))),t.cmd===k.a.SubmitRule){var e=this.state.value.split("\n");(e=this.rulesCheck(e))?(this.setState((function(t){return{check:"OK"}})),console.log("[RulesInputSystem] ",e),v.getChannel("grid:1").put({cmd:k.a.PathRobot,rules:e})):this.setState((function(t){return{check:"Rule ERROR"}}))}}},{key:"render",value:function(){var t=this;return h.a.createElement("div",{className:"ruleInput"},h.a.createElement("p",null,"\u89c4\u5219"),h.a.createElement("div",null,h.a.createElement("textarea",{rows:"20",cols:"50",value:this.state.value,onChange:function(t){}})),h.a.createElement("div",{id:"start"},h.a.createElement("button",{onClick:function(){var e={cmd:k.a.SubmitRule};t.channel.put(e)}},"\u5f00\u59cb")),h.a.createElement("p",null,this.state.check))}}]),e}(g),K=function(t){function e(t){var n;Object(i.a)(this,e);(n=Object(s.a)(this,Object(c.a)(e).call(this,t))).grid=new G("grid:1");return n.ruleInput=new N("ruleInput:1"),n}return Object(u.a)(e,t),Object(r.a)(e,[{key:"render",value:function(){return h.a.createElement("div",{className:"room"},h.a.createElement(T,{entity:this.grid}),h.a.createElement("div",{id:"score"},h.a.createElement("label",null,"\u5f97\u5206:",this.grid.getScore())),h.a.createElement("div",{id:"refresh"},h.a.createElement("button",{onClick:function(){var t={cmd:k.a.Refresh};v.getChannel("grid:1").put(t)}},"\u5237\u65b0")),h.a.createElement(V,{entity:this.ruleInput}))}}]),e}(l.Component),W=function(t){function e(t){return Object(i.a)(this,e),Object(s.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(r.a)(e,[{key:"render",value:function(){return h.a.createElement("div",null,h.a.createElement("ul",null,h.a.createElement("li",null,h.a.createElement(U.b,{to:"/sweep-turing-machine"},"\u5bfb\u627e\u626b\u5730\u673a\u5668\u4eba"))))}}]),e}(l.Component),q=function(t){function e(t){return Object(i.a)(this,e),Object(s.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(r.a)(e,[{key:"render",value:function(){return h.a.createElement(U.a,{basename:""},h.a.createElement("div",null,h.a.createElement(D.c,null,h.a.createElement(D.a,{exact:!0,path:"/",component:W}),h.a.createElement(D.a,{exact:!0,path:"/sweep-turing-machine",component:K}),h.a.createElement(D.a,{component:function(){return h.a.createElement("div",null,"404 Not found ")}}))))}}]),e}(l.Component);f.a.render(h.a.createElement(q,null),document.getElementById("root"))},4:function(t,e){t.exports={CanCross:"CanCross",SetRobot:"SetRobot",ClearRobot:"ClearRobot",Refresh:"Refresh",PathRobot:"PathRobot",SubmitRule:"SubmitRule"}}},[[24,1,2]]]);