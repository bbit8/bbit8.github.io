(this.webpackJsonpbbit8=this.webpackJsonpbbit8||[]).push([[0],{24:function(t,e,n){t.exports=n(36)},30:function(t,e,n){},36:function(t,e,n){"use strict";n.r(e);var a=n(13),i=n.n(a),s=n(1),o=n(2),r=n(9),c=n(8),u=n(10),l=n(0),h=n.n(l),b=n(21),d=n.n(b),f=n(4),k=n.n(f),v=new(function(){function t(){Object(s.a)(this,t),this.channels={}}return Object(o.a)(t,[{key:"addChannel",value:function(t,e){this.channels[t]=e}},{key:"getChannel",value:function(t){return this.channels[t]}},{key:"removeChannel",value:function(t){delete this.channels[t]}}]),t}()),y=new(function(){function t(){Object(s.a)(this,t),this.level="debug"}return Object(o.a)(t,[{key:"debug",value:function(){var t;"debug"===this.level&&(t=console).log.apply(t,arguments)}}]),t}()),p=1,m=2,g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m;Object(s.a)(this,t),this.message=[],this.takers=[],this.mode=e}return Object(o.a)(t,[{key:"put",value:function(t){if(this.takers.length>0)if(this.mode===p){var e=this.takers.slice();this.takers=[];var n=!0,a=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var r=s.value;try{r(t)}catch(c){y.debug("[Channel] put error: ",t,c)}}}catch(u){a=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}}else this.takers.shift()(t);else this.message.push(t)}},{key:"take",value:function(){var t=this;return new Promise((function(e){t.message.length>0?e(t.message.shift()):t.takers.push(e)}))}},{key:"hasTaker",value:function(){return this.takers.length>0}}]),t}(),R=new(function(){function t(){Object(s.a)(this,t),this.entities={}}return Object(o.a)(t,[{key:"addEntity",value:function(t,e){this.entities[t]=e}},{key:"getEntity",value:function(t){return this.entities[t]}},{key:"removeEntity",value:function(t){delete this.entities[t]}}]),t}()),C=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(r.a)(this,Object(c.a)(e).call(this,t))).mounted=!1,t.entity&&n.init(t.entity),n}return Object(u.a)(e,t),Object(o.a)(e,[{key:"init",value:function(t){this.entity=t,this.id=this.entity.id,R.addEntity(this.id,this.entity),this.state=this.entity.getState(),this.channel=new g,v.addChannel(this.id,this.channel)}},{key:"componentDidMount",value:function(){this.mounted=!0,this.loop()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"loop",value:function(){var t;return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.mounted){e.next=7;break}return e.next=3,i.a.awrap(this.channel.take());case 3:t=e.sent,this.remote(t),e.next=0;break;case 7:case"end":return e.stop()}}),null,this)}},{key:"updateState",value:function(t){Object.assign(this.entity.state,t),this.setState(t)}},{key:"remote",value:function(t){}}]),e}(l.Component),O=function(){function t(e){Object(s.a)(this,t),this.id=e,this.state={canCross:!0,isRobot:!1,clean:!1}}return Object(o.a)(t,[{key:"hasClean",value:function(){return this.state.clean}},{key:"getState",value:function(){return this.state}},{key:"setCross",value:function(t){this.state.canCross=t}},{key:"canCross",value:function(){return this.state.canCross}},{key:"setRobot",value:function(){this.state.isRobot=!0,this.state.clean=!0}}]),t}(),S=0,j=1,I=2,E=3,L=4,x=0,w=1,M=2,B=3,N=4,U=function(){function t(e){Object(s.a)(this,t),this.id=e,this.state={refresh:!1,score:1},this.difficulty=.2,this.blocks=[],this.blockIdMap={},this.blockLocGrid=[[],[],[],[]],this.blockIdLocMap={},this.canCrossBlocks=[],this.robotId=0,this.robotState=S,this.initBlocks()}return Object(o.a)(t,[{key:"hasBlockClean",value:function(t){return this.blockIdMap[t].hasClean()}},{key:"cleanBlock",value:function(t){return this.blockIdMap[t].hasClean()}},{key:"getState",value:function(){return this.state}},{key:"getBlocks",value:function(){return this.blocks}},{key:"getRobotId",value:function(){return this.robotId}},{key:"getRandomRobotId",value:function(){return this.canCrossBlocks[Math.floor(Math.random()*this.canCrossBlocks.length)].id}},{key:"setRobotId",value:function(t){this.robotId=t,this.robotState=S}},{key:"initBlocks",value:function(){for(var t=[],e=[],n=0;n<16;++n){var a="block:".concat(n+1),i=new O(a),s=Math.random()>=this.difficulty;s&&e.push(i),i.setCross(s),t.push(i);var o=n%4,r=Math.floor(n/4);this.blockLocGrid[o][r]=a,this.blockIdLocMap[a]=[o,r],this.blockIdMap[a]=i,this.canCrossBlocks=e}this.blocks=t,this.initRobot()}},{key:"initRobot",value:function(){var t=this.canCrossBlocks[Math.floor(Math.random()*this.canCrossBlocks.length)];this.robotId=t.id,t.setRobot()}},{key:"updateRobotLoc",value:function(t,e){var n=t.slice();switch(e){case j:return n[0]--,n;case I:return n[0]++,n;case E:return n[1]--,n;case L:return n[1]++,n}}},{key:"getRobotSurr",value:function(t){var e="",n=this.updateRobotLoc(t,j),a=this.blockLocGrid[n[0]],i=a?a[n[1]]:0;return i&&this.blockIdMap[i].canCross()?e+="x":e+="U",n=this.updateRobotLoc(t,I),(i=(a=this.blockLocGrid[n[0]])?a[n[1]]:0)&&this.blockIdMap[i].canCross()?e+="x":e+="D",n=this.updateRobotLoc(t,E),(i=(a=this.blockLocGrid[n[0]])?a[n[1]]:0)&&this.blockIdMap[i].canCross()?e+="x":e+="L",n=this.updateRobotLoc(t,L),(i=(a=this.blockLocGrid[n[0]])?a[n[1]]:0)&&this.blockIdMap[i].canCross()?e+="x":e+="R",e}},{key:"getRobotActionByRules",value:function(t){var e=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var r=s.value;r.state===this.robotState&&e.push(r)}}catch(M){a=!0,i=M}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}y.debug("[getRobotActionByRules] effectiveRules:%j",e);for(var c=this.blockIdLocMap[this.robotId],u=this.getRobotSurr(c),l=0,h=e;l<h.length;l++){var b=h[l];if(b.match(u))switch(this.robotState=b.newState,b.action){case"U":var d=this.updateRobotLoc(c,j),f=this.blockLocGrid[d[0]],k=f?f[d[1]]:0;if(k)if(this.blockIdMap[k].canCross())return{action:w,loc:d,id:k};case"D":var v=this.updateRobotLoc(c,I),p=this.blockLocGrid[v[0]],m=p?p[v[1]]:0;if(m)if(this.blockIdMap[m].canCross())return{action:w,loc:v,id:m};case"L":var g=this.updateRobotLoc(c,E),R=this.blockLocGrid[g[0]],C=R?R[g[1]]:0;if(C)if(this.blockIdMap[C].canCross())return{action:w,loc:g,id:C};case"R":var O=this.updateRobotLoc(c,L),S=this.blockLocGrid[O[0]],x=S?S[O[1]]:0;if(x)if(this.blockIdMap[x].canCross())return{action:w,loc:O,id:x}}}}},{key:"getRobotAction",value:function(){switch(this.robotState){case S:case j:case I:case E:case L:var t=this.blockIdLocMap[this.robotId],e=this.updateRobotLoc(t,j),n=this.blockLocGrid[e[0]],a=n?n[e[1]]:0;if(a)if(this.blockIdMap[a].canCross())return{action:w,loc:e,id:a};if(e=this.updateRobotLoc(t,I),a=(n=this.blockLocGrid[e[0]])?n[e[1]]:0)if(this.blockIdMap[a].canCross())return{action:M,loc:e,id:a};if(e=this.updateRobotLoc(t,E),a=(n=this.blockLocGrid[e[0]])?n[e[1]]:0)if(this.blockIdMap[a].canCross())return{action:B,loc:e,id:a};if(e=this.updateRobotLoc(t,L),a=(n=this.blockLocGrid[e[0]])?n[e[1]]:0)if(this.blockIdMap[a].canCross())return{action:N,loc:e,id:a}}return{action:x,loc:this.blockIdLocMap[this.robotId],id:this.robotId}}}]),t}(),G=function(){function t(e){Object(s.a)(this,t),this.id=e,this.state={value:"# \u89c4\u5219\u683c\u5f0f: \n#\t\u72b6\u6001 \u5468\u56f4\u73af\u5883 -> \u52a8\u4f5c \u65b0\u72b6\u6001\n# \u72b6\u6001\u96c6\u5408: \n#\t0-\u9759\u6b62 1-\u5411\u4e0a 2-\u5411\u4e0b 3-\u5411\u5de6 4-\u5411\u53f3\n# \u5468\u56f4\u73af\u5883\u8868\u793a:\n#\tx-\u53ef\u901a\u884c U/D/L/R-\u4e0d\u53ef\u901a\u884c *-\u4efb\u610f\n#\t\u6bd4\u5982,\n#\t1)UDLR \u8868\u793a\u4e0a\u4e0b\u5de6\u53f3\u90fd\u4e0d\u53ef\u901a\u884c\n#\t2)x*** \u8868\u793a\u673a\u5668\u4eba\u4e0a\u65b9\u53ef\u901a\u884c\uff0c\u5176\u4ed6\u4efb\u610f\n#\t3)U*** \u8868\u793a\u673a\u5668\u4eba\u4e0a\u65b9\u4e0d\u53ef\u901a\uff0c\u5176\u4ed6\u4efb\u610f\n# \u52a8\u4f5c\u96c6\u5408: \n#\tU-\u5411\u4e0a D-\u5411\u4e0b L-\u5411\u5de6 R-\u5411\u53f3\n# \n# \u673a\u5668\u4eba\u521d\u59cb\u72b6\u6001\u4e3a0\n# \n0 x*** -> U 1\n0 U*** -> D 1\n1 x*** -> U 1\n1 U*** -> D 2\n2 *x** -> D 2\n",check:""}}return Object(o.a)(t,[{key:"getState",value:function(){return this.state}}]),t}(),P=function(){function t(e){Object(s.a)(this,t);var n=e.split(" ");this.state=n[0]-0,this.surr=n[1],this.action=n[3],this.newState=n[4]-0}return Object(o.a)(t,[{key:"match",value:function(t){for(var e=0;e<this.surr.length;++e){var n=t[e],a=this.surr[e];if("*"!==a&&a!==n)return!1}return!0}}]),t}(),D=(n(30),n(16)),J=n(11);function A(t){return new Promise((function(e){return setTimeout(e,t)}))}var T=function(t){function e(t){return Object(s.a)(this,e),Object(r.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(o.a)(e,[{key:"getStyle",value:function(){return this.state.canCross?this.state.clean?"cleanBlock":"block":"barrier"}},{key:"remote",value:function(t){switch(y.debug("[BlockSystem] id:".concat(this.id,", msg:").concat(JSON.stringify(t),", state:").concat(JSON.stringify(this.state),",     entity state:").concat(JSON.stringify(this.entity.state))),t.cmd){case k.a.CanCross:this.updateState({canCross:t.canCross,clean:!1});break;case k.a.SetRobot:this.updateState({isRobot:!0,clean:!0});break;case k.a.ClearRobot:this.updateState({isRobot:!1});break;case k.a.ResetEntity:this.init(t.entity),this.updateState(this.state)}}},{key:"getRobotView",value:function(){if(this.state.isRobot)return h.a.createElement("div",{className:"robot"})}},{key:"render",value:function(){return h.a.createElement("div",{className:this.getStyle()},this.getRobotView())}}]),e}(C),V=function(t){function e(t){var n;return Object(s.a)(this,e),(n=Object(r.a)(this,Object(c.a)(e).call(this,t))).blockSystems=[],n.initBlockSystem(),n.robotPath=!1,n}return Object(u.a)(e,t),Object(o.a)(e,[{key:"initBlockSystem",value:function(){for(var t=[],e=this.entity.getBlocks(),n=0;n<e.length;++n)t.push(h.a.createElement(T,{key:n+1,entity:e[n]}));this.blockSystems=t}},{key:"remote",value:function(t){y.debug("[GridSystem] id:".concat(this.id,", msg:").concat(JSON.stringify(t),", state:").concat(JSON.stringify(this.state),",     entity state:").concat(JSON.stringify(this.entity.state))),t.cmd===k.a.Refresh?this.updateState({refresh:!this.entity.state.refresh,score:1}):t.cmd===k.a.PathRobot?(this.robotPath=!0,this.pathRobot(t.rules)):t.cmd===k.a.UpdateScore&&this.updateState({score:this.entity.state.score+1})}},{key:"refresh",value:function(){this.robotPath=!1,this.entity.initBlocks();for(var t=this.entity.getBlocks(),e=0;e<t.length;++e){var n=t[e];v.getChannel(n.id).put({cmd:k.a.ResetEntity,entity:n})}}},{key:"pathRobot",value:function(t){var e,n,a,s,o,r,c,u;return i.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(!this.robotPath){l.next=30;break}for(e=[],n=!0,a=!1,s=void 0,l.prev=5,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0)c=r.value,e.push(new P(c));l.next=13;break;case 9:l.prev=9,l.t0=l.catch(5),a=!0,s=l.t0;case 13:l.prev=13,l.prev=14,n||null==o.return||o.return();case 16:if(l.prev=16,!a){l.next=19;break}throw s;case 19:return l.finish(16);case 20:return l.finish(13);case 21:if(u=this.entity.getRobotActionByRules(e),y.debug("[pathRobot] robotPath:".concat(this.robotPath,", action:%j"),u),u){l.next=25;break}return l.abrupt("break",30);case 25:return this.setRobot(u.id),l.next=28,i.a.awrap(A(850));case 28:l.next=0;break;case 30:case"end":return l.stop()}}),null,this,[[5,9,13,21],[14,,16,20]])}},{key:"setRobot",value:function(t){var e=this.entity.getRobotId();e&&v.getChannel(e).put({cmd:k.a.ClearRobot}),e=t||this.entity.getRandomRobotId(),this.entity.setRobotId(e);var n=this.entity.hasBlockClean(e);y.debug("[setRobot] index:".concat(t,", robotId:").concat(e,", hasClean:").concat(n)),t&&!n&&this.channel.put({cmd:k.a.UpdateScore}),y.debug("getRobot ",e),v.getChannel(e).put({cmd:k.a.SetRobot})}},{key:"render",value:function(){return this.state.refresh&&(this.channel.put({cmd:k.a.Refresh}),this.refresh()),h.a.createElement("div",null,h.a.createElement("div",{className:"grid"},this.blockSystems),h.a.createElement("div",{className:"gridPanel"},h.a.createElement("div",{id:"score"},h.a.createElement("label",null,"\u5f97\u5206: ",this.state.score)),h.a.createElement("div",{id:"refresh"},h.a.createElement("button",{onClick:function(){var t={cmd:k.a.Refresh};v.getChannel("grid:1").put(t)}},"\u5237\u65b0"))))}}]),e}(C),K=function(t){function e(t){return Object(s.a)(this,e),Object(r.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(o.a)(e,[{key:"rulesCheck",value:function(t){var e=[],n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var r=s.value,c=r.split(" ");if(y.debug("[rulesCheck]",c),c.length&&c[0].length&&"#"!==c[0][0]){if(5!==c.length)return{result:!1,rule:r,reason:"\u683c\u5f0f\u9519\u8bef"};var u=parseInt(c[0]),l=c[1],h=c[3],b=parseInt(c[4]);if(y.debug("[rulesCheck]",u,l,h,b),isNaN(u)||u<0||u>4)return y.debug("[rulesCheck]  state error",u),{result:!1,rule:r,reason:"\u3010\u72b6\u6001\u3011\u5b9a\u4e49\u9519\u8bef"};if(isNaN(b)||b<0||b>4)return y.debug("[rulesCheck]  newState error",b),{result:!1,rule:r,reason:"\u3010\u65b0\u72b6\u6001\u3011\u5b9a\u4e49\u9519\u8bef"};if("U"!==h&&"D"!==h&&"L"!==h&&"R"!==h)return y.debug("[rulesCheck]  action error",h),{result:!1,rule:r,reason:"\u3010\u52a8\u4f5c\u3011\u5b9a\u4e49\u9519\u8bef"};if(4!==l.length||"x"!==l[0]&&"*"!==l[0]&&"U"!==l[0]||"x"!==l[1]&&"*"!==l[1]&&"D"!==l[1]||"x"!==l[2]&&"*"!==l[2]&&"L"!==l[2]||"x"!==l[3]&&"*"!==l[3]&&"R"!==l[3])return y.debug("[rulesCheck]  surr error",l),{result:!1,rule:r,reason:"\u3010\u5468\u56f4\u73af\u5883\u3011\u5b9a\u4e49\u9519\u8bef"};e.push(r)}}}catch(d){a=!0,i=d}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return{result:!0,rules:e}}},{key:"remote",value:function(t){if(y.debug("[RulesInputSystem] id:".concat(this.id,", msg:").concat(JSON.stringify(t))),t.cmd===k.a.SubmitRule){var e=this.state.value.split("\n"),n=this.rulesCheck(e);n.result?(this.updateState({check:"OK"}),e=n.rules,y.debug("[RulesInputSystem] ",e),v.getChannel("grid:1").put({cmd:k.a.PathRobot,rules:e})):this.updateState({check:"\u6821\u9a8c\u9519\u8bef\uff1a\u89c4\u5219\uff1a".concat(n.rule,"  \u539f\u56e0\uff1a").concat(n.reason)})}else t.cmd===k.a.ChangeRule&&this.updateState({value:t.value})}},{key:"render",value:function(){var t=this;return h.a.createElement("div",{className:"ruleInput"},h.a.createElement("p",null,"\u89c4\u5219"),h.a.createElement("div",null,h.a.createElement("textarea",{rows:"20",cols:"50",value:this.state.value,onChange:function(e){var n={cmd:k.a.ChangeRule,value:e.target.value};t.channel.put(n)}})),h.a.createElement("div",{id:"start"},h.a.createElement("button",{onClick:function(){var e={cmd:k.a.SubmitRule};t.channel.put(e)}},"\u5f00\u59cb")),h.a.createElement("p",null,this.state.check))}}]),e}(C),W=function(t){function e(t){var n;Object(s.a)(this,e);(n=Object(r.a)(this,Object(c.a)(e).call(this,t))).grid=new U("grid:1");return n.ruleInput=new G("ruleInput:1"),n}return Object(u.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){return h.a.createElement("div",{className:"room"},h.a.createElement("p",null,"\u5bfb\u627e\u626b\u5730\u673a"),h.a.createElement(V,{entity:this.grid}),h.a.createElement(K,{entity:this.ruleInput}))}}]),e}(l.Component),q=function(t){function e(t){return Object(s.a)(this,e),Object(r.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){return h.a.createElement("div",null,h.a.createElement("ul",null,h.a.createElement("li",null,h.a.createElement(D.b,{to:"/sweep-turing-machine"},"\u5bfb\u627e\u626b\u5730\u673a"))))}}]),e}(l.Component),z=function(t){function e(t){return Object(s.a)(this,e),Object(r.a)(this,Object(c.a)(e).call(this,t))}return Object(u.a)(e,t),Object(o.a)(e,[{key:"render",value:function(){return h.a.createElement(D.a,{basename:"/"},h.a.createElement("div",null,h.a.createElement(J.c,null,h.a.createElement(J.a,{exact:!0,path:"/",component:q}),h.a.createElement(J.a,{exact:!0,path:"/sweep-turing-machine",component:W}))))}}]),e}(l.Component);d.a.render(h.a.createElement(z,null),document.getElementById("root"))},4:function(t,e){t.exports={CanCross:"CanCross",SetRobot:"SetRobot",ClearRobot:"ClearRobot",ResetEntity:"ResetEntity",Refresh:"Refresh",PathRobot:"PathRobot",UpdateScore:"UpdateScore",SubmitRule:"SubmitRule",ChangeRule:"ChangeRule"}}},[[24,1,2]]]);